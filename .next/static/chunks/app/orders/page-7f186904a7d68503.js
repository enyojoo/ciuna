(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[569],{8464:function(e,t,r){Promise.resolve().then(r.bind(r,6674))},6674:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var s=r(9659),a=r(3330),n=r(1097),l=r(9059),i=r(6675),c=r(4660);let o=(0,r(8136).Z)("Truck",[["path",{d:"M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11",key:"hs4xqm"}],["path",{d:"M14 9h4l4 4v4c0 .6-.4 1-1 1h-2",key:"11fp61"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}]]);var u=r(9201),d=r(7790),h=r(230),x=r(7835),m=r(3344),g=r(3070),y=r(4535);function f(){let{user:e}=(0,n.a)(),[t,r]=(0,a.useState)([]),[f,p]=(0,a.useState)(!0),[b,j]=(0,a.useState)("buying");(0,a.useEffect)(()=>{e&&v()},[e,b]);let v=async()=>{try{p(!0);let t="buying"===b?{buyer_id:null==e?void 0:e.id}:{seller_id:null==e?void 0:e.id},{data:s}=await g.db.orders.getAll(t,1,50);r(s)}catch(e){console.error("Error loading orders:",e)}finally{p(!1)}},N=e=>{switch(e){case"PENDING":return(0,s.jsx)(i.Z,{className:"h-5 w-5 text-yellow-500"});case"PAID":return(0,s.jsx)(c.Z,{className:"h-5 w-5 text-blue-500"});case"FULFILLING":return(0,s.jsx)(o,{className:"h-5 w-5 text-purple-500"});case"DELIVERED":return(0,s.jsx)(c.Z,{className:"h-5 w-5 text-green-500"});case"CANCELLED":return(0,s.jsx)(u.Z,{className:"h-5 w-5 text-red-500"});default:return(0,s.jsx)(d.Z,{className:"h-5 w-5 text-gray-500"})}},w=e=>{switch(e){case"PENDING":return"bg-yellow-100 text-yellow-800";case"PAID":return"bg-blue-100 text-blue-800";case"FULFILLING":return"bg-purple-100 text-purple-800";case"DELIVERED":return"bg-green-100 text-green-800";case"CANCELLED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return f?(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsx)("div",{className:"space-y-6",children:Array.from({length:5}).map((e,t)=>(0,s.jsx)("div",{className:"animate-pulse",children:(0,s.jsx)("div",{className:"bg-gray-200 rounded-lg h-32"})},t))})}):(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Orders"}),(0,s.jsx)("p",{className:"text-lg text-gray-600",children:"Track your purchases and sales"})]}),(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)("div",{className:"border-b border-gray-200",children:(0,s.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,s.jsxs)("button",{onClick:()=>j("buying"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("buying"===b?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Buying (",t.filter(t=>t.buyer_id===(null==e?void 0:e.id)).length,")"]}),(0,s.jsxs)("button",{onClick:()=>j("selling"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("selling"===b?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Selling (",t.filter(t=>t.seller_id===(null==e?void 0:e.id)).length,")"]})]})})}),0===t.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(d.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No orders yet"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"buying"===b?"You haven't made any purchases yet.":"You haven't received any orders yet."}),(0,s.jsx)(l.zx,{asChild:!0,children:(0,s.jsx)("a",{href:"buying"===b?"/listings":"/sell/new",children:"buying"===b?"Start Shopping":"Create Listing"})})]}):(0,s.jsx)("div",{className:"space-y-6",children:t.map(e=>(0,s.jsx)(l.Zb,{className:"hover:shadow-lg transition-shadow",children:(0,s.jsx)(l.aY,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[N(e.status),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Order #",e.id]}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:(0,y.SY)(e.created_at)})]}),(0,s.jsx)(l.Ct,{className:w(e.status),children:e.status})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"buying"===b?"Seller":"Buyer"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"buying"===b?"Unknown Seller":"Unknown Buyer"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Total Amount"}),(0,s.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:(0,y.T4)(e.total_amount_rub)})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4 mb-4 p-4 bg-gray-50 rounded-lg",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"h-16 w-16 bg-gray-200 rounded-lg flex items-center justify-center",children:(0,s.jsx)(i.Z,{className:"h-8 w-8 text-gray-400"})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900",children:"Order Item"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Item details not available"})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsx)("p",{className:"font-medium text-gray-900",children:(0,y.T4)(e.total_amount_rub)})})]}),(0,s.jsx)("div",{className:"mb-4 p-4 bg-green-50 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-green-900",children:"Escrow Protection"}),(0,s.jsxs)("p",{className:"text-sm text-green-800",children:[e.escrow_amount_rub," RUB held in escrow"]})]}),(0,s.jsx)(l.Ct,{variant:"success",children:e.escrow_status})]})})]}),(0,s.jsxs)("div",{className:"flex flex-col space-y-2 ml-4",children:[(0,s.jsxs)(l.zx,{variant:"outline",size:"sm",children:[(0,s.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"View Details"]}),(0,s.jsxs)(l.zx,{variant:"outline",size:"sm",children:[(0,s.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Message"]}),"DELIVERED"===e.status&&(0,s.jsxs)(l.zx,{variant:"outline",size:"sm",children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Leave Review"]})]})]})})},e.id))})]})}},1097:function(e,t,r){"use strict";r.d(t,{H:function(){return i},a:function(){return c}});var s=r(9659),a=r(3330),n=r(3070);let l=(0,a.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,a.useState)(null),[c,o]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{try{let{data:{session:e}}=await n.OQ.auth.getSession();if(null==e?void 0:e.user){i(e.user);let t=await n.eH.getCurrentProfile();o(t)}}catch(e){console.error("Error getting initial session:",e)}finally{d(!1)}})();let{data:{subscription:e}}=n.OQ.auth.onAuthStateChange(async(e,t)=>{if(null==t?void 0:t.user){i(t.user);try{let e=await n.eH.getCurrentProfile();o(e)}catch(e){console.error("Error fetching profile:",e),o(null)}}else i(null),o(null);d(!1)});return()=>e.unsubscribe()},[]);let h=async(e,t)=>{d(!0);try{let{error:r}=await n.OQ.auth.signInWithPassword({email:e,password:t});if(r)throw r}catch(e){throw console.error("Error signing in:",e),e}finally{d(!1)}},x=async(e,t,r)=>{d(!0);try{let{error:s}=await n.OQ.auth.signUp({email:e,password:t,options:{data:r}});if(s)throw s}catch(e){throw console.error("Error signing up:",e),e}finally{d(!1)}},m=async()=>{d(!0);try{let{error:e}=await n.OQ.auth.signOut();if(e)throw e}catch(e){throw console.error("Error signing out:",e),e}finally{d(!1)}},g=async e=>{if(!c)throw Error("No profile found");try{let t=await n.eH.updateCurrentProfile(e);o(t)}catch(e){throw console.error("Error updating profile:",e),e}};return(0,s.jsx)(l.Provider,{value:{user:r,profile:c,loading:u,signIn:h,signUp:x,signOut:m,updateProfile:g},children:t})}function c(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4535:function(e,t,r){"use strict";r.d(t,{SY:function(){return c},T4:function(){return i},cn:function(){return l}});var s=r(7833),a=r(1128),n=r(2597);function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,s.W)(t))}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"RUB";return(0,n.xG)(e,t)}function c(e){let t=new Date(e),r=Math.floor((new Date().getTime()-t.getTime())/1e3);if(r<60)return"Just now";let s=Math.floor(r/60);if(s<60)return"".concat(s,"m ago");let a=Math.floor(s/60);if(a<24)return"".concat(a,"h ago");let n=Math.floor(a/24);return n<7?"".concat(n,"d ago"):n<30?"".concat(Math.floor(n/7),"w ago"):n<365?"".concat(Math.floor(n/30),"mo ago"):"".concat(Math.floor(n/365),"y ago")}},4660:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(8136).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},230:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(8136).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},7835:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(8136).Z)("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]])},6675:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(8136).Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},7790:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(8136).Z)("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]])},3344:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(8136).Z)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]])},9201:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(8136).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])}},function(e){e.O(0,[584,782,750,70,642,526,560],function(){return e(e.s=8464)}),_N_E=e.O()}]);