(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[381],{9899:function(e,t,r){Promise.resolve().then(r.bind(r,609))},609:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var s=r(9659),i=r(3330),a=r(9584),l=r(9059),n=r(4317),c=r(9198);let o=(0,r(8136).Z)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var d=r(1674),u=r(1097),m=r(3070);function h(){let{user:e,profile:t}=(0,u.a)(),r=(0,a.useRouter)(),[h,x]=(0,i.useState)(!1),[p,g]=(0,i.useState)([]),[b,y]=(0,i.useState)({title:"",description:"",category_id:"",price_rub:"",condition:"GOOD",city:"",district:"",photo_urls:[]}),[f,j]=(0,i.useState)({});(0,i.useEffect)(()=>{if(!e){r.push("/auth/signin");return}N()},[e,r]);let N=async()=>{try{let e=await m.db.categories.getAll();g(e)}catch(e){console.error("Error loading categories:",e)}},v=e=>{let{name:t,value:r}=e.target;y(e=>({...e,[t]:r})),f[t]&&j(e=>({...e,[t]:""}))},_=e=>{y(t=>({...t,photo_urls:t.photo_urls.filter((t,r)=>r!==e)}))},w=()=>{let e={};return b.title.trim()||(e.title="Title is required"),b.description.trim()||(e.description="Description is required"),b.category_id||(e.category_id="Category is required"),(!b.price_rub||isNaN(Number(b.price_rub))||0>=Number(b.price_rub))&&(e.price_rub="Valid price is required"),b.city.trim()||(e.city="City is required"),j(e),0===Object.keys(e).length},k=async t=>{if(t.preventDefault(),w()){x(!0);try{let t={...b,price_rub:parseInt(b.price_rub),category_id:b.category_id,seller_id:(null==e?void 0:e.id)||"",status:"ACTIVE",currency:"RUB",is_negotiable:!0,tags:[]},s=await m.db.listings.create(t);r.push("/listings/".concat(s.id))}catch(e){console.error("Error creating listing:",e),j({submit:"Failed to create listing. Please try again."})}finally{x(!1)}}};return e?(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Create New Listing"}),(0,s.jsx)("p",{className:"text-lg text-gray-600",children:"Sell your items to fellow expats in Russia"})]}),(0,s.jsxs)(l.Zb,{children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{children:"Listing Details"})}),(0,s.jsx)(l.aY,{children:(0,s.jsxs)("form",{onSubmit:k,className:"space-y-6",children:[f.submit&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md text-sm",children:f.submit}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),(0,s.jsx)(l.II,{id:"title",name:"title",value:b.title,onChange:v,placeholder:"What are you selling?",className:f.title?"border-red-300":""}),f.title&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:f.title})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),(0,s.jsx)("textarea",{id:"description",name:"description",value:b.description,onChange:v,rows:4,placeholder:"Describe your item in detail...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(f.description?"border-red-300":"")}),f.description&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:f.description})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"category_id",className:"block text-sm font-medium text-gray-700 mb-2",children:"Category *"}),(0,s.jsxs)("select",{id:"category_id",name:"category_id",value:b.category_id,onChange:v,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(f.category_id?"border-red-300":""),children:[(0,s.jsx)("option",{value:"",children:"Select a category"}),p.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]}),f.category_id&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:f.category_id})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"condition",className:"block text-sm font-medium text-gray-700 mb-2",children:"Condition"}),(0,s.jsx)("select",{id:"condition",name:"condition",value:b.condition,onChange:v,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[{value:"NEW",label:"New"},{value:"LIKE_NEW",label:"Like New"},{value:"GOOD",label:"Good"},{value:"FAIR",label:"Fair"}].map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"price_rub",className:"block text-sm font-medium text-gray-700 mb-2",children:"Price (RUB) *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(n.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,s.jsx)(l.II,{id:"price_rub",name:"price_rub",type:"number",value:b.price_rub,onChange:v,placeholder:"0",className:"pl-10 ".concat(f.price_rub?"border-red-300":"")})]}),f.price_rub&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:f.price_rub})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700 mb-2",children:"City *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(c.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,s.jsx)(l.II,{id:"city",name:"city",value:b.city,onChange:v,placeholder:"Moscow, St. Petersburg, etc.",className:"pl-10 ".concat(f.city?"border-red-300":"")})]}),f.city&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:f.city})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"district",className:"block text-sm font-medium text-gray-700 mb-2",children:"District (Optional)"}),(0,s.jsx)(l.II,{id:"district",name:"district",value:b.district,onChange:v,placeholder:"Arbat, Nevsky Prospekt, etc."})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Photos"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex items-center justify-center w-full",children:(0,s.jsxs)("label",{htmlFor:"photos",className:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[(0,s.jsx)(o,{className:"w-8 h-8 mb-4 text-gray-500"}),(0,s.jsxs)("p",{className:"mb-2 text-sm text-gray-500",children:[(0,s.jsx)("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"PNG, JPG up to 10MB each"})]}),(0,s.jsx)("input",{id:"photos",type:"file",multiple:!0,accept:"image/*",onChange:e=>{let t=e.target.files;if(t){let e=Array.from(t).map(e=>URL.createObjectURL(e));y(t=>({...t,photo_urls:[...t.photo_urls,...e]}))}},className:"hidden"})]})}),b.photo_urls.length>0&&(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:b.photo_urls.map((e,t)=>(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:e,alt:"Upload ".concat(t+1),className:"w-full h-24 object-cover rounded-lg"}),(0,s.jsx)("button",{type:"button",onClick:()=>_(t),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:(0,s.jsx)(d.Z,{className:"h-4 w-4"})})]},t))})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,s.jsx)(l.zx,{type:"button",variant:"outline",onClick:()=>r.back(),children:"Cancel"}),(0,s.jsx)(l.zx,{type:"submit",disabled:h,children:h?"Creating...":"Create Listing"})]})]})})]})]}):null}},1097:function(e,t,r){"use strict";r.d(t,{H:function(){return n},a:function(){return c}});var s=r(9659),i=r(3330),a=r(3070);let l=(0,i.createContext)(void 0);function n(e){let{children:t}=e,[r,n]=(0,i.useState)(null),[c,o]=(0,i.useState)(null),[d,u]=(0,i.useState)(!0);(0,i.useEffect)(()=>{(async()=>{try{let{data:{session:e}}=await a.OQ.auth.getSession();if(null==e?void 0:e.user){n(e.user);let t=await a.eH.getCurrentProfile();o(t)}}catch(e){console.error("Error getting initial session:",e)}finally{u(!1)}})();let{data:{subscription:e}}=a.OQ.auth.onAuthStateChange(async(e,t)=>{if(null==t?void 0:t.user){n(t.user);try{let e=await a.eH.getCurrentProfile();o(e)}catch(e){console.error("Error fetching profile:",e),o(null)}}else n(null),o(null);u(!1)});return()=>e.unsubscribe()},[]);let m=async(e,t)=>{u(!0);try{let{error:r}=await a.OQ.auth.signInWithPassword({email:e,password:t});if(r)throw r}catch(e){throw console.error("Error signing in:",e),e}finally{u(!1)}},h=async(e,t,r)=>{u(!0);try{let{error:s}=await a.OQ.auth.signUp({email:e,password:t,options:{data:r}});if(s)throw s}catch(e){throw console.error("Error signing up:",e),e}finally{u(!1)}},x=async()=>{u(!0);try{let{error:e}=await a.OQ.auth.signOut();if(e)throw e}catch(e){throw console.error("Error signing out:",e),e}finally{u(!1)}},p=async e=>{if(!c)throw Error("No profile found");try{let t=await a.eH.updateCurrentProfile(e);o(t)}catch(e){throw console.error("Error updating profile:",e),e}};return(0,s.jsx)(l.Provider,{value:{user:r,profile:c,loading:d,signIn:m,signUp:h,signOut:x,updateProfile:p},children:t})}function c(){let e=(0,i.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4317:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(8136).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},9198:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(8136).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},1674:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(8136).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},9584:function(e,t,r){"use strict";var s=r(8569);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[584,782,750,70,642,526,560],function(){return e(e.s=9899)}),_N_E=e.O()}]);