(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[840],{6038:function(e,t,s){Promise.resolve().then(s.bind(s,6838))},6838:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var a=s(9659),r=s(3330),n=s(1097),l=s(9059),c=s(8754),i=s(7835),o=s(658),d=s(8136);let u=(0,d.Z)("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),x=(0,d.Z)("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),h=(0,d.Z)("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),m=(0,d.Z)("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),g=(0,d.Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);var f=s(3070),y=s(4535);function p(){let{user:e}=(0,n.a)(),[t,s]=(0,r.useState)([]),[d,p]=(0,r.useState)(null),[j,v]=(0,r.useState)([]),[N,b]=(0,r.useState)(""),[w,k]=(0,r.useState)(!0),[S,Z]=(0,r.useState)("");(0,r.useEffect)(()=>{e&&E()},[e]),(0,r.useEffect)(()=>{d&&z(d.id)},[d]);let E=async()=>{try{k(!0);let{data:t}=await f.db.conversations.getAll((null==e?void 0:e.id)||"",1,50);s(t)}catch(e){console.error("Error loading conversations:",e)}finally{k(!1)}},z=async e=>{try{let{data:t}=await f.db.messages.getAll(e,1,100);v(t)}catch(e){console.error("Error loading messages:",e)}},C=async t=>{if(t.preventDefault(),N.trim()&&d)try{await f.db.messages.create({conversation_id:d.id,sender_id:(null==e?void 0:e.id)||"",content:N.trim(),message_type:"TEXT"}),b(""),z(d.id)}catch(e){console.error("Error sending message:",e)}},M=e=>null,_=t.filter(e=>!0);return w?(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)("div",{className:"animate-pulse space-y-4",children:Array.from({length:5}).map((e,t)=>(0,a.jsx)("div",{className:"h-20 bg-gray-200 rounded"},t))})}):(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Messages"}),(0,a.jsx)("p",{className:"text-lg text-gray-600",children:"Chat with buyers and sellers"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[600px]",children:[(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsxs)(l.Zb,{className:"h-full",children:[(0,a.jsx)(l.Ol,{className:"pb-4",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(c.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsx)("input",{type:"text",placeholder:"Search conversations...",value:S,onChange:e=>Z(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),(0,a.jsx)(l.aY,{className:"p-0",children:0===_.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(i.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No conversations yet"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Start a conversation by messaging a seller"})]}):(0,a.jsx)("div",{className:"space-y-1",children:_.map(e=>(M(e),(0,a.jsx)("div",{onClick:()=>p(e),className:"p-4 cursor-pointer hover:bg-gray-50 border-b border-gray-100 ".concat((null==d?void 0:d.id)===e.id?"bg-blue-50":""),children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(l.qE,{src:void 0,fallback:"U",size:"md"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:"Unknown User"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"No messages"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 truncate",children:"No recent messages"})]}),(0,a.jsx)(l.Ct,{variant:"default",className:"bg-blue-500",children:"0"})]})},e.id)))})})]})}),(0,a.jsx)("div",{className:"lg:col-span-2",children:d?(0,a.jsxs)(l.Zb,{className:"h-full flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(l.qE,{src:void 0,fallback:"U",size:"md"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:"Unknown User"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Online"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(l.zx,{variant:"ghost",size:"sm",children:(0,a.jsx)(o.Z,{className:"h-4 w-4"})}),(0,a.jsx)(l.zx,{variant:"ghost",size:"sm",children:(0,a.jsx)(u,{className:"h-4 w-4"})}),(0,a.jsx)(l.zx,{variant:"ghost",size:"sm",children:(0,a.jsx)(x,{className:"h-4 w-4"})})]})]})}),(0,a.jsx)("div",{className:"flex-1 p-4 overflow-y-auto space-y-4",children:0===j.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(i.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"No messages yet. Start the conversation!"})]}):j.map(t=>(0,a.jsx)("div",{className:"flex ".concat(t.sender_id===(null==e?void 0:e.id)?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat(t.sender_id===(null==e?void 0:e.id)?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"),children:[(0,a.jsx)("p",{className:"text-sm",children:t.content}),(0,a.jsx)("p",{className:"text-xs mt-1 ".concat(t.sender_id===(null==e?void 0:e.id)?"text-blue-100":"text-gray-500"),children:(0,y.SY)(t.created_at)})]})},t.id))}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,a.jsxs)("form",{onSubmit:C,className:"flex items-center space-x-2",children:[(0,a.jsx)(l.zx,{variant:"ghost",size:"sm",type:"button",children:(0,a.jsx)(h,{className:"h-4 w-4"})}),(0,a.jsx)("input",{type:"text",value:N,onChange:e=>b(e.target.value),placeholder:"Type a message...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)(l.zx,{variant:"ghost",size:"sm",type:"button",children:(0,a.jsx)(m,{className:"h-4 w-4"})}),(0,a.jsx)(l.zx,{type:"submit",disabled:!N.trim(),children:(0,a.jsx)(g,{className:"h-4 w-4"})})]})})]}):(0,a.jsx)(l.Zb,{className:"h-full flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(i.Z,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Select a conversation"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Choose a conversation from the list to start chatting"})]})})})]})]})}},1097:function(e,t,s){"use strict";s.d(t,{H:function(){return c},a:function(){return i}});var a=s(9659),r=s(3330),n=s(3070);let l=(0,r.createContext)(void 0);function c(e){let{children:t}=e,[s,c]=(0,r.useState)(null),[i,o]=(0,r.useState)(null),[d,u]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{try{let{data:{session:e}}=await n.OQ.auth.getSession();if(null==e?void 0:e.user){c(e.user);let t=await n.eH.getCurrentProfile();o(t)}}catch(e){console.error("Error getting initial session:",e)}finally{u(!1)}})();let{data:{subscription:e}}=n.OQ.auth.onAuthStateChange(async(e,t)=>{if(null==t?void 0:t.user){c(t.user);try{let e=await n.eH.getCurrentProfile();o(e)}catch(e){console.error("Error fetching profile:",e),o(null)}}else c(null),o(null);u(!1)});return()=>e.unsubscribe()},[]);let x=async(e,t)=>{u(!0);try{let{error:s}=await n.OQ.auth.signInWithPassword({email:e,password:t});if(s)throw s}catch(e){throw console.error("Error signing in:",e),e}finally{u(!1)}},h=async(e,t,s)=>{u(!0);try{let{error:a}=await n.OQ.auth.signUp({email:e,password:t,options:{data:s}});if(a)throw a}catch(e){throw console.error("Error signing up:",e),e}finally{u(!1)}},m=async()=>{u(!0);try{let{error:e}=await n.OQ.auth.signOut();if(e)throw e}catch(e){throw console.error("Error signing out:",e),e}finally{u(!1)}},g=async e=>{if(!i)throw Error("No profile found");try{let t=await n.eH.updateCurrentProfile(e);o(t)}catch(e){throw console.error("Error updating profile:",e),e}};return(0,a.jsx)(l.Provider,{value:{user:s,profile:i,loading:d,signIn:x,signUp:h,signOut:m,updateProfile:g},children:t})}function i(){let e=(0,r.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4535:function(e,t,s){"use strict";s.d(t,{SY:function(){return i},T4:function(){return c},cn:function(){return l}});var a=s(7833),r=s(1128),n=s(2597);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"RUB";return(0,n.xG)(e,t)}function i(e){let t=new Date(e),s=Math.floor((new Date().getTime()-t.getTime())/1e3);if(s<60)return"Just now";let a=Math.floor(s/60);if(a<60)return"".concat(a,"m ago");let r=Math.floor(a/60);if(r<24)return"".concat(r,"h ago");let n=Math.floor(r/24);return n<7?"".concat(n,"d ago"):n<30?"".concat(Math.floor(n/7),"w ago"):n<365?"".concat(Math.floor(n/30),"mo ago"):"".concat(Math.floor(n/365),"y ago")}},7835:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(8136).Z)("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]])},658:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(8136).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},8754:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(8136).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])}},function(e){e.O(0,[584,782,750,70,642,526,560],function(){return e(e.s=6038)}),_N_E=e.O()}]);